<!doctype html>
<html>
	<head>
		<title>learningthree.js boiler plate for three.js</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		
			
    <script src="http://ajax.googleapis.com/ajax/libs/prototype/1.7.1.0/prototype.js"></script>
    <script src="vendor/cannon/Cannon.js"></script>
    <script src="vendor/three/Three.js"></script>
		<script src="vendor/three/Detector.js"></script>
		<!-- https://github.com/mrdoob/stats.js -->
		<script src="vendor/three/Stats.js"></script>
		<script src="vendor/threex/THREEx.screenshot.js"></script>
		<script src="vendor/threex/THREEx.FullScreen.js"></script>
		<script src="vendor/threex/THREEx.WindowResize.js"></script>
		<script src="vendor/threex/THREEx.DragPanControls.js"></script>
    <script src="vendor/threex/THREEx.KeyboardState.js"></script>
    <script src="vendor/EventEmitter.js"></script>
    <script src="vendor/Underscore.js"></script>
    <script src="vendor/dat.gui.min.js"></script>
    <script src="js/physics.js"></script>
    <script src="js/input.js"></script>
    <script src="js/game.js"></script>
    <script src="js/component.js"></script>
    <script src="js/entity.js"></script>
    <script src="js/prefab.js"></script>
    <script src="js/components/controller.js"></script>
    <script src="js/components/rigidbody.js"></script>
    <script src="js/components/follow.js"></script>

		<link  href="css/main.css" rel="stylesheet"/>
	</head>
<body>
  <div id="amoeba"></div>
	<script type="text/javascript">
    var Amoeba = new Game({
      canvas: 'amoeba',
      width: window.innerWidth,
      height: window.innerHeight,
      debug: true,
      release: false
    });

    Prefab.define("PlayerCamera", function() {
      var camera = new Entity.Camera(
        45, 
        window.innerWidth / window.innerHeight,
        0.1,
        10000
      ); 

      var follow = new Follow();
      follow.offset = new THREE.Vector3(0, 200, -1); //Fuck you, gimbal.

      var controls = new Controller({
        'forward': function() {
          var tar = this.getComponent("follow").target;
          tar.getComponent("rigidbody")._body.force.z = 200;
        },
        'left': function() {
          var tar = this.getComponent("follow").target;
          tar.getComponent("rigidbody")._body.force.x = 200;
        },
        'right': function() {
          var tar = this.getComponent("follow").target;
          tar.getComponent("rigidbody")._body.force.x = -200;
        },
        'back': function() {
          var tar = this.getComponent("follow").target;
          tar.getComponent("rigidbody")._body.force.z = -200;
        }
      });
      camera.addComponent(follow);
      camera.addComponent(controls);
      return camera;
    });
    var camera = Amoeba.addEntity("PlayerCamera");

        

    Prefab.define("Ball", function() {
      var geo = new THREE.SphereGeometry()
        , mat = new THREE.MeshNormalMaterial()
        , col = new CANNON.Sphere(50);

      var sphere = new Entity.Mesh("Sphere", geo, mat);
      var sbdy = new Rigidbody(5, col); 
      sbdy._body.position.set(0, 100, 0);
      
      sphere.addComponent(sbdy);
      return sphere;
    });
    var ball = Amoeba.addEntity("Ball");
    camera.getComponent("follow").target = ball;

    Prefab.define("Ground", function() {
      var pln = new THREE.PlaneGeometry(1000, 1000, 20, 20)
        , gma = new THREE.MeshBasicMaterial({ color: 0x333333, wireframe: true })
        , gcd = new CANNON.Plane();

      var ground = new Entity.Mesh("Ground", pln, gma);
      var sbd = new Rigidbody(0, gcd);
      sbd._body.quaternion.setFromAxisAngle(
        new CANNON.Vec3(1, 0, 0), 
        -Math.PI / 2
      );

      ground.addComponent(sbd);
      return ground;
    });
    Amoeba.addEntity("Ground");

    var helpZ = new THREE.ArrowHelper(
      new THREE.Vector3(0, 0, 1),
      new THREE.Vector3(0, 0, 0),
      50,
      0xFF0000
    );
    var helpX = new THREE.ArrowHelper(
      new THREE.Vector3(1, 0, 0),
      new THREE.Vector3(0, 0, 0),
      50,
      0x00FF00
    );
    Amoeba._scene.add(helpZ);
    Amoeba._scene.add(helpX);
    Amoeba.run();
    
	</script>
</body>
</html>
